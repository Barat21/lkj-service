# ===============================
# DataSource Configuration
# ===============================
spring.datasource.url=jdbc:postgresql://aws-1-ap-southeast-1.pooler.supabase.com:6543/postgres?sslmode=require
spring.datasource.username=postgres.pdrtprrumxbphvrcltrb
spring.datasource.password=barat2197@Aa
spring.datasource.driver-class-name=org.postgresql.Driver

# Required for PgBouncer (disable prepared statement caching)
spring.datasource.hikari.data-source-properties.prepareThreshold=0

# Allow monitoring via JMX
spring.datasource.hikari.register-mbeans=true

# ===============================
# JPA / Hibernate
# ===============================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# ===============================
# HikariCP tuning for Supabase free tier (~15 max connections)
# ===============================

# Max 5 connections in pool
spring.datasource.hikari.maximum-pool-size=5

# Keep only 1 idle connection
spring.datasource.hikari.minimum-idle=1

# Idle timeout in ms (10s) - free idle connections quickly
spring.datasource.hikari.idle-timeout=10000

# Max lifetime in ms (30s) - recycle connections before Supabase closes them
spring.datasource.hikari.max-lifetime=30000

# Connection timeout in ms (20s) - wait for a connection before failing
spring.datasource.hikari.connection-timeout=20000
